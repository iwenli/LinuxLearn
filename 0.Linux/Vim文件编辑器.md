# Vim 文件编辑器

## Vim的工作模式
在使用 Vim 编辑文件前，我们先来了解一下它的三种工作模式：命令模式、输入模式和编辑模式，如图 1 所示。

![图 1 Vim 的三种工作模式](http://c.biancheng.net/uploads/allimg/181008/2-1Q00Q41T01J.jpg)

### 命令模式
使用 Vim 编辑文件时，默认处于命令模式。在此模式下，可以使用上、下、左、右键或者 k、j、h、l 命令进行光标移动，还可以对文件内容进行复制、粘贴、替换、删除等操作。
### 输入模式
在输入模式下可以对文件执行写操作，类似在 Windows 的文档中输入内容。进入输入模式的方法是输入 i、a、o 等插入命令，编写完成后按 Esc 键即可返回命令模式。
### 编辑模式
如果要保存、查找或者替换一些内容等，就需要进入编辑模式。编辑模式的进入方法为：在命令模式下按":"键，Vim 窗口的左下方会出现一个":"符号，这时就可以输入相关的指令进行操作了。指令执行后会自动返回命令模式。

> 对于新手来说，经常不知道自己处于什么模式。不论是自己忘了，还是不小心切换了模式，都可以按一次 Esc 键返回命令模式。如果你多按几次 Esc 键后听到"嘀————"的声音，则代表你已经处于命令模式了。


## Vim基本操作

### 使用Vim打开文件

#### 直接打开 
``` shell 
vim test.vim
```

#### 直接进入指定位置

如果想直接进入 Vim 编辑文件的指定行数处或者特定字符串所在行，节省编辑时间，例如，打开 test.vim 文件时直接进入第 20 行，则可以这样操作：
``` shell
vim +20 test.vim
```
打开文件后，直接进入"nobody"字符串所在行，则可以这样操作：
``` shell
vim +/nobody test.vim
```

如果文件中有多个"nobody"字符串，则会以査到的第一个为准。

打开文件后，接下来开始对文件进行编辑。Vim 虽然基于文本模式的编辑器，但却提供了丰富的编辑功能。对于习惯使用图形界面的朋友来说，刚开始会较难适应，但是熟练后就会发现，使用 Vim 进行编辑实际上更加快速。

### 插入命令
从命令模式进入输入模式进行编辑，可以按下 `I、i、O、o、A、a` 等键来完成，不同的键只是光标所处的位置不同而已。当进入输入模式后，你会发现，在 Vim 编辑窗口的左下角会出现"INSERT"标志，这就代表我们可行写入操作了 

#### 常用的插入命令：
+ i：在当前光标所在位置插入随后输入的文本，光标后的文本相应向右移动
+ I：在光标所在行的行首插入随后输入的文本，行首是该行的第一个非空白字符，相当于光标移动到行首执行i命令
+ a：在当前光标所在位置之后插入随后输入的文本
+ A：在光标所在行的行尾插入随后输入的文本，相当于光标移动到行尾再执行a命令
+ o：在光标所在行的下面插入新的一行。光标停在空行首，等待输入文本
+ O：在光标所在行的上面插入新的一行。光标停在空行的行首，等待输入文本

> 注意，在 Linux 纯字符界面中，默认是不支持中文输入的。如果想要输入中文，则有三种方法：
安装中文语言支持和图形界面，在图形界面下输入中文，使用 gVim (Vim 的图形前端）。
安装中文语言支持，使用远程连接工具（如 PuTTY），在远程连接工具中调整中文编码，进行中文输入。
倘若非要在 Linux 纯字符界面中输入中文，则可以安装中文插件，如 zhcon。

### 光标移动命令
在进行编辑工作之前，需要将光标移动到适当的位置。Vim 提供了大量的光标移动命令，注意这些命令需要在命令模式下执行。下面介绍一些常用的光标移动命令。

#### 以字符为单位移动
习惯使用鼠标的用户可能很自然地想到用光标来进行编辑定位，但是你会发现鼠标不会给你任何反应。在Vim中进行定位需要通过上、下、左、右方向键，并且无论是命令模式还是输入模式，都可以通过方向键来移动光标（在编辑模式中，方向键是用来査看命令历史记录的）。

另外，还可以在命令模式中使用 `h、j、k、l` 这 4 个字符控制方向，分别表示向左、向下、向上、向左。在大量编辑文档时，会频繁地移动光标，这时使用方向键可能会比较浪费时间，使用这 4 个键就很方便快捷。当然，这同样是一件熟能生巧的事情。

#### 以单词为单位移动
有时候需要迅速进入一行中的某个位置，如果能使光标一次移动一个单词就会非常方便。可以在命令模式中使用"W"命令来使光标向后跳到下一个单词的单词首，或者使用"b"命令使光标向前跳到上一个单词的单词首，还可以使用"e"命令使光标跳到下一个单词的单词尾，即：
+ w：移动光标到下一个单词的单词首
+ b：移动光标到上一个单词的单词首
+ e：移动光标到下一个单词的单词尾

#### 移动到行尾或者行首
可以使用"$"命令将光标移至行尾，或者使用"0"或"^"命令将光标移至行首。其实，对于 $ 命令来说，可以使用诸如"n$"之类的命令来将光标移至当前光标所在行的之后 n 行的行尾（n 为数字）;对于"0"命令来说却不可以，但可以用"n^"。

#### 移动到一行的指定字符处（f 命令）
如果在一行中需要将光标移动到当前行的某个特定字符处，则可以使用 f 命令。

例如，某行为"you can you up, no can no bb"，现在需要将光标移动到字符 p 处，则可以使用"fp"命令，这样光标就会迅速定位到字符 p 处。f 命令有一个使用条件，即光标需在指定字符前。

#### 移动到匹配的括号处（%命令）
如果你是一名程序员，那么在使用 Vim 进行编辑时经常会为将光标移动到与一个"("匹配的")"(对于 [] 和 {} 也是一样的）处而感到头疼。其实在 Vim 里面提供了一个非常方便地査找匹配括号的命令，这就是"%"。

比如，在 /etc/init.d/sshd 脚本文件中（最好还是复制后练习，小心驶得万年船），想迅速地将光标定位到与第 49 行的"{"相对应的"}"处，则可以将光标先定位在"{"处，然后再使用"％"命令，使之定位在"}"处

#### 移动到指定行处(nG 或 :n 命令)
可以直接在命令模式中输入"nG"（n 为数字，G 为大写）或":n"（在编辑模式中输入数字）命令将光标快速地定位到指定行的行首。这种方法对快速移动光标非常有效。
``` shell
gg #命令将光标移动到文档开头 
G #命令将光标移动到文档末尾
```

### 使用Vim进行编辑
光标移动到指定位置后，如何进行编辑操作呢？Vim 提供了大量的编辑命令，下面介绍其中一些常用的命令。

#### 査找指定字符串
一个字符串可以是一个或者多个字母的集合。如果想在 Vim 中査找字符串，则需要在命令模式下进行。在 Vim 命令模式中输入"/要査找的字符串"，再按一下回车键，就可以从光标所在行开始向下査找指定的字符串。如果要向上査找，则只需输入"？要査找的字符串"即可。
如果匹配的字符串有多个，则可以按"n"键向下继续匹配査找，按"N"键向上继续匹配査找。
如果在文件中并没有找到所要査找的字符串，则在文件底部会出现"Pattern not found"提示。
在査找过程中需要注意的是，要査找的字符串是严格区分大小写的，如査找"shenchao"和"ShenChao"会得到不同的结果。
如果想忽略大小写，则输入命令 ":set ic"；调整回来输入":set noic"。
如果在字符串中出现特殊符号，则需要加上转义字符"\"。常见的特殊符号有 \、*、?、\ $ 等。
如果出现这些字符，例如，要査找字符串"10$"，则需要在命令模式中输入"/10\$"。
还可以查找指定的行。例如，要査找一个以 root 为行首的行，则可以进行如下操作：
```/^root```
要査找一个以 root 为行尾的行，则可以进行如下操作：
```/root$```

#### 使用Vim进行替换
小写"r"可以替换光标所在处的某个字符，将光标移动到想替换的单个字符处，按下"r"键，然后直接输入替换的字符即可。
大写"R"可以从光标所在处开始替换字符，输入会覆盖后面的文本内容，直到按 Esc 键结束。
按下"R"键替换后，Vim 编辑文件左下角会显示"REPLACE"，进入替换状态。笔者在第一行"root"后输入英文"need just word, word has word"，直到按 Esc 键才会退出替换；否则将一直处于替换状态。

批量替换格式如下：
替换范围内的字符串：:替换起始处，替换结束处s/源字符串/替换的字符串/g。
替换整篇文档的字符串：:%s/源字符串/替换的字符串/g（如果不加g，则只替换每行第一个找到的字符串）。

例如，要将某文件中所有的"root"替换为"liudehua"，则有两种输入命令，分别为：
``` shell
:1, $s/root/liudehua/g
#或
:%s/root/liudehua/g
```
上述命令是在编辑模式下操作的，表示的是从第一行到最后一行，即全文査找"root"，然后替换成"liudehua"。
如果刚才的命令变成:10,20 s/root/liudehua/g，则只替换从第 10 行到第 20 行的"root"。
#### 使用 Vim 进行删除、粘贴、复制
如果处于命令模式下，则可以按下"x"键来删除光标所在位置的单个字符；快速按两下"d"键来进行整行删除；
如果想要删除连续多行，例如，想要删除 10 行，则可按下"10dd"，可以快速删除当前光标所在行下 10 行。此时被删除的内容并没有真正删除，都临时放在了内存中。将光标移动到指定位置处，按下"p"键，就可以将刚才删除的内容又粘贴到此处。在软件开发中可能需要将连续两行进行互换，就可以将上面的一行过"dd"键删除，再将光标移动到下面，通过"p"键将其重新粘贴，这样就能够达到两行互换位置的目的。

"dG"键可以删除从光标所在行一直到文件末尾的全部内容，而"D"键可以删除从光标所在处到这行行尾的内容。如果要删除指定范围的行，则可以用":起始行，终止行d"。如删除第 1~3 行，则输入":1, 3d"，如图 6 所示，会提示"3 fewer lines"。
还有"yy"键来复制单行，或者通过在前面加上数字来复制当前光标所在行下的多行。
有时候可能需要把两行进行连接。如在下面的文件中有两行，现在需要使其成为一行，实际上就是将两行间的换行符去掉。可以直接在命令模式中按下"J"键。

#### 使用Vim撤销上一步操作
如果不小心误删除了文件内容，则可以通过"u"键来撤销刚才执行的命令。如果要撤销刚才的多次操作，可以多按几次"u"键。


### 保存退出命令
估计前面一大堆的操作已经让你有些力不从心了，其实，这还只是总结出来的常用部分，不过对于曰常使用基本足够了，不用死记硬背，只需多练习就能掌握。

Vim 的保存和退出是在命令模式中进行的，为了方便记忆，只需要记住 w、q、！三个符号的含义即可完成任务：
+ 字母"w"：保存不退出；
+ 字母"q"：不保存退出；
+ 字符"!"：强制性操作；

例如，在命令模式中只输入"W"字母，就意味着保存但不退出；
如果输入"wq"就意味着保存并且退出；
如果输入"w!"或"wq!"就意味着强制保存或强制保存退出，这种情况经常发生在对文件没有写权限的时候（显示 readonly，如图 8 所示），但如果你是文件的所有者或者 root 用户，就可以强制执行。

其他用法，如"q!"表示不保存退出；保留源文件，而另存为其他的文件，可以用"w新文件名"，如"w /tmp/shadow.vi"。

> 在命令模式中，还可以输入"ZZ"命令退出，按两次"Shift+Z"快捷键方便，笔者强烈推荐。此时如果对文件没有修改，就是不保存退出；如果对文件已经进行了修改，就是保存后退出。



## Vim显示行号方法详解
在使用 Vim 进行编辑的过程中，经常会遇到需要同时对连续几行进行操作的情况，这时如果每行都有行号提示，就会非常方便。

在命令模式下输入":set nu"即可显示每一行的行号。
如果想要取消行 号，则再次输入":set nonu"即可。

如果希望每次打开文件都默认显示行号，则可以编辑 Vim 的配置文件。每次使用 Vim 打开文件时，Vim 都会到当前登录用户的宿主目录（用户配置文件所在地）中读取 .vimrc 文件，此文件可以对 Vim 进行一些默认配置设定。

如果 .vimrc 文件存在，就先读取其中对 Vim 的设置；否则就采取默认配置。在默认情况下，用户宿主目录中是没有此文件的，需要在当前用户的宿主目录中手工建立，如"vim~/.vimrc"，"~"代表宿主目录，root 的宿主目录为 /root/，普通用户的宿主目录存放在 /home/ 目录下。可以直接使用 Vim 编辑生成此文件，并在此文件中添加一行"set nu"，保存并退出。之后此用户登录，每次 Vim 打开文件时，都会默认显示行号。常见的可以写入 .vimrc 文件中的设置参数如。

设置参数 | 含 义
- | -
:set nu <br> :set nonu	| 设置与取消行号。
:syn on <br> :syn off	| 是否依据语法显示相关的颜色帮助。在Vim中修改相关的配置文件或Shell脚本文件 时（如前面示例的脚本/etc/init.d/sshd)，默认会显示相应的颜色，用来帮助排错。如果觉得颜色产生了干扰，则可以取消此设置
set hlsearch <br> set nohlsearch |	设置是否将査找的字符串高亮显示。默认是hlsearch高亮显示
set nobackup <br> set backup |	是否保存自动备份文件。默认是nobackup不自动备份。如果设定了:set backup，则会产生“文件名〜”作为备份文件
set ruler <br> set noruler | 设置是否显示右下角的状态栏。默认是ruler显示
set showmode <br> set noshowmode |	设置是否在左下角显示如“一INSERT--”之类的状态栏。<br>默认是showmode显示 设置参数实在太多了，这里只列举了常见的几个，可以使用":set all"命令査看所有的设置参数。<br>这些设置参数都可以写入 .vimrc 配置文件中，让它们永久生效，也可在 Vim 中执行，让它们临时生效。